services:
  api:
    build:
      context: ..
      dockerfile: docker/Dockerfile.api
    image: qwen3-tts-api:local
    ports:
      - "8001:8001"
    volumes:
      - ../models:/app/models
      - ../voices:/app/voices
      - ../outputs:/app/outputs
      - ../configs:/app/configs
    environment:
      - MODELS_DIR=/app/models
      - VOICES_DIR=/app/voices
      - OUTPUTS_DIR=/app/outputs
      - DEVICE=cuda:0
      - DTYPE=float16
    # GPU (compose v2 supports this; requires NVIDIA Container Toolkit)
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: ["gpu"]

  ui:
    build:
      context: ..
      dockerfile: docker/Dockerfile.ui
    image: qwen3-tts-ui:local
    ports:
      - "7860:7860"
    depends_on:
      - api
    volumes:
      - ../models:/app/models
      - ../voices:/app/voices
      - ../outputs:/app/outputs
      - ../configs:/app/configs
    environment:
      - UI_MODE=api
      - API_URL=http://api:8001
