FROM python:3.12-slim

ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1

WORKDIR /app

RUN apt-get update && apt-get install -y --no-install-recommends \
    ffmpeg \
  && rm -rf /var/lib/apt/lists/*

COPY pyproject.toml /app/pyproject.toml
COPY README.md /app/README.md
COPY src /app/src

RUN python -m pip install --upgrade pip \
 && pip install -e ".[ui]"

RUN mkdir -p /app/models /app/voices /app/outputs /app/configs

EXPOSE 7860

CMD ["python", "-m", "tts_platform.cli", "run-ui", "--host", "0.0.0.0", "--port", "7860", "--config", "configs/docker.yaml"]
